# PROJECT_LOG.md

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Add onboarding back button to login
- **Summary:**
  - Added a back action on `OnboardingCreateOrgScreen` so users can return to the sign-in screen.
  - Implemented the action with `navigation.replace("Login")` to avoid leaving onboarding on the back stack.
- **Files changed:**
  - `src/navigation/screens/OnboardingCreateOrgScreen.tsx`
  - `PROJECT_LOG.md`
- **Commands run:**
  - `Get-Content -Raw AGENTS.md`
  - `Get-Content -Tail 140 PROJECT_LOG.md`
  - `npx tsc --noEmit`
- **How to verify:**
  - Open `Create your driving school` screen.
  - Tap `Back to sign in`.
  - Confirm the app navigates to `LoginScreen`.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Signup email verification confirmation dialog
- **Summary:**
  - Updated `Create account` flow to show a confirmation alert after sign-up when email verification is required.
  - Alert message is `Check your email to verify your account.` and `OK` returns the user to `Login`.
  - Removed the previous inline confirmation text block from the signup screen.
- **Files changed:**
  - `src/navigation/screens/SignupScreen.tsx`
  - `PROJECT_LOG.md`
- **Commands run:**
  - `Get-Content -Raw AGENTS.md`
  - `Get-Content -Tail 120 PROJECT_LOG.md`
  - `npx tsc --noEmit`
- **How to verify:**
  - Open `Create account`, enter a new email/password, and tap `Create account`.
  - Confirm an alert appears with `Check your email to verify your account.`.
  - Tap `OK` and confirm navigation returns to `LoginScreen`.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Force consistent default light theme on first launch
- **Summary:**
  - Fixed theme hydration mismatch by syncing provider state and NativeWind color scheme from a single resolved value (`stored` or default `light`).
  - Added a theme-ready gate in root navigation to avoid rendering mixed themed surfaces before color scheme initialization finishes.
  - Moved status bar theme source to `ColorSchemeProvider` so it always matches app theme.
- **Files changed:**
  - `src/providers/ColorSchemeProvider.tsx`
  - `src/navigation/RootNavigation.tsx`
  - `App.tsx`
  - `PROJECT_LOG.md`
- **Commands run:**
  - `Get-Content -Raw AGENTS.md`
  - `Get-Content -Raw PROJECT_LOG.md`
  - `npx tsc --noEmit`
- **How to verify:**
  - Fresh install APK on device and launch app for the first time.
  - Confirm login/auth screens and drawer/navigation surfaces are all light mode (no mixed dark sidebar).
  - Open Settings and toggle dark mode, then relaunch app to confirm persisted mode still applies consistently.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Confirm before creating student + rename create CTA
- **Summary:**
  - Added a confirmation alert on `StudentCreate` submit with `Back` and `Confirm` options before persisting a new student.
  - Kept edit flow unchanged (updates still save directly).
  - Renamed create-screen primary button from `Save student` to `Add student`.
- **Files changed:**
  - `src/navigation/screens/StudentEditScreen.tsx`
  - `PROJECT_LOG.md`
- **Commands run:**
  - `Get-Content -Raw AGENTS.md`
  - `Get-Content -Raw PROJECT_LOG.md`
  - `npx tsc --noEmit`
- **How to verify:**
  - Open `Students` -> `New student`, fill required fields, and tap `Add student`.
  - Confirm alert appears with `Back` and `Confirm`.
  - Tap `Back` and verify no student is created.
  - Tap `Add student` again and then `Confirm`; verify you are navigated to the new student detail.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Add hazard detection and response controls to full mock test
- **Summary:**
  - Added a new `Hazard Detection and Response` section above `Assessment items (Pass/Fail)` in `Mock Test - Full License`.
  - Implemented category rows (`Pedestrians`, `Vehicles`, `Others`) with letter-box subcategories and a Yes/No/N/A modal picker.
  - Set `N/A` as the default for all hazard subcategories and color-coded selected boxes (`Yes` = green, `No` = red).
  - Enforced validation so each task attempt must include at least one non-`N/A` hazard response before recording.
  - Extended stored attempt data and PDF export to include hazard response selections.
- **Files changed:**
  - `src/navigation/screens/FullLicenseMockTestScreen.tsx`
  - `src/features/assessments/full-license-mock-test/constants.ts`
  - `src/features/assessments/full-license-mock-test/scoring.ts`
  - `src/features/assessments/full-license-mock-test/schema.ts`
  - `src/features/assessments/full-license-mock-test/pdf.ts`
  - `PROJECT_LOG.md`
- **Commands run:**
  - `Get-Content -Raw AGENTS.md`
  - `Get-Content -Raw PROJECT_LOG.md`
  - `npx tsc --noEmit`
- **How to verify:**
  - Open `Assessments` -> `Mock Test - Full License`, start a run, and go to `Record task attempt`.
  - Confirm `Hazard Detection and Response` appears above `Assessment items (Pass/Fail)`.
  - Tap hazard boxes for each category row and confirm a modal appears with `Yes`, `No`, and `N/A`.
  - Confirm selected box colors: green for `Yes`, red for `No`, neutral for `N/A`.
  - Leave all hazard boxes as `N/A`, tap `Record task attempt`, and confirm validation blocks save.
  - Set at least one hazard to `Yes` or `No`, then confirm the attempt records successfully.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Align full mock test hazard columns vertically
- **Summary:**
  - Updated hazard matrix layout to use fixed direction columns (`L`, `R`, `A`, `B`, `O`) for every category row.
  - Added empty placeholders for directions not used in a category so matching subcategory letters align vertically across rows.
- **Files changed:**
  - `src/navigation/screens/FullLicenseMockTestScreen.tsx`
  - `PROJECT_LOG.md`
- **Commands run:**
  - `Get-Content -Raw AGENTS.md`
  - `Get-Content -Tail 120 PROJECT_LOG.md`
  - `npx tsc --noEmit`
- **How to verify:**
  - Open `Assessments` -> `Mock Test - Full License` -> start run -> `Record task attempt`.
  - In `Hazard Detection and Response`, confirm `L` boxes are vertically aligned across `Pedestrians`, `Vehicles`, and `Others`.
  - Confirm the same vertical alignment for `R`, `A`, `B`, and `O`.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Archive PROJECT_LOG and enforce 30-entry cap
- **Summary:**
  - Archived older entries from `PROJECT_LOG.md` into `docs/logs/PROJECT_LOG_ARCHIVE.md`.
  - Added a 30-entry rolling cap rule and archive instructions in `AGENTS.md`.
  - Added `docs/logs/INDEX.md` to document active vs archived log paths.
- **Files changed:**
  - `AGENTS.md`
  - `PROJECT_LOG.md`
  - `docs/logs/INDEX.md`
  - `docs/logs/PROJECT_LOG_ARCHIVE.md`
- **Commands run:**
  - `Get-Content -Raw AGENTS.md`
  - `Get-Content -Raw PROJECT_LOG.md`
  - `rg --no-heading "^- \*\*Date:\*\*" PROJECT_LOG.md`
  - PowerShell archive script (move old entries + keep latest 30)
- **How to verify:**
  - Confirm `PROJECT_LOG.md` contains only the most recent 30 entries.
  - Confirm older entries exist in `docs/logs/PROJECT_LOG_ARCHIVE.md`.
  - Confirm `AGENTS.md` includes the 30-entry archive rule.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Reduce active project log cap to 20 entries
- **Summary:**
  - Updated logging policy to keep only the latest 20 entries in `PROJECT_LOG.md`.
  - Archived older active entries into `docs/logs/PROJECT_LOG_ARCHIVE.md` to match the new cap.
- **Files changed:**
  - `AGENTS.md`
  - `PROJECT_LOG.md`
  - `docs/logs/PROJECT_LOG_ARCHIVE.md`
- **Commands run:**
  - `Get-Content -Raw AGENTS.md`
  - `Get-Content -Raw PROJECT_LOG.md`
  - `rg -n "30-entry|most recent 30|exceed 30" AGENTS.md`
  - PowerShell archive script (append entry + keep latest 20)
- **How to verify:**
  - Confirm `PROJECT_LOG.md` contains only the most recent 20 entries.
  - Confirm older entries are present in `docs/logs/PROJECT_LOG_ARCHIVE.md`.
  - Confirm `AGENTS.md` references a 20-entry cap.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Add admin role with owner-equivalent permissions
- **Summary:**
  - Added a new Supabase migration to allow `profiles.role = 'admin'` and apply owner-equivalent RLS behavior for admin users.
  - Updated app role gates so owner-only flows (logo management, instructor creation, assignment controls) also allow admins.
  - Updated create-instructor Edge Function and org-logo storage policy SQL to allow both owners and admins.
- **Files changed:**
  - `src/features/auth/roles.ts`
  - `src/navigation/screens/StudentEditScreen.tsx`
  - `src/navigation/screens/LessonEditScreen.tsx`
  - `src/navigation/screens/StudentSessionHistoryScreen.tsx`
  - `src/navigation/screens/SettingsScreen.tsx`
  - `src/navigation/screens/AddInstructorScreen.tsx`
  - `src/supabase/types.ts`
  - `supabase/migrations/010_admin_role.sql`
  - `supabase/functions/create-instructor/index.ts`
  - `supabase/storage/org-logos.sql`
  - `supabase/README.md`
  - `PROJECT_LOG.md`
  - `docs/logs/PROJECT_LOG_ARCHIVE.md`
- **Commands run:**
  - `npx tsc --noEmit`
- **How to verify:**
  - Apply `supabase/migrations/010_admin_role.sql` in Supabase SQL Editor.
  - Set one profile role to `admin` and confirm admin can create instructors and change org logo.
  - Confirm instructor permissions remain restricted to assigned records.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Add drawer sign-out with confirmation
- **Summary:**
  - Added a `Sign out` action in the sidebar menu above the bottom divider/settings block.
  - Added a confirmation alert (`Cancel` / `Sign out`) before signing out.
  - On confirmation, triggers auth sign-out so the app returns to the login flow.
- **Files changed:**
  - `src/navigation/components/AppDrawerContent.tsx`
  - `PROJECT_LOG.md`
  - `docs/logs/PROJECT_LOG_ARCHIVE.md`
- **Commands run:**
  - `npx tsc --noEmit`
- **How to verify:**
  - Open the drawer and confirm `Sign out` appears above the divider and `Settings`.
  - Tap `Sign out` and confirm the confirmation alert appears.
  - Tap `Cancel` and confirm you remain signed in.
  - Tap `Sign out` in the alert and confirm you are returned to `LoginScreen`.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Add delete actions and save confirmations for students/lessons
- **Summary:**
  - Excluded `admin` from assignable instructor options on `New student` and `New lesson` screens.
  - Added save confirmations for `Edit student` and for both `New lesson`/`Edit lesson` submissions.
  - Added permanent `Delete student` action on student profile and icon-only `Delete lesson` action on edit lesson header.
  - Added student/lesson delete API + query mutations and new RLS delete policies migration.
- **Files changed:**
  - `src/navigation/screens/StudentEditScreen.tsx`
  - `src/navigation/screens/LessonEditScreen.tsx`
  - `src/navigation/screens/StudentDetailScreen.tsx`
  - `src/features/students/api.ts`
  - `src/features/students/queries.ts`
  - `src/features/lessons/api.ts`
  - `src/features/lessons/queries.ts`
  - `supabase/migrations/011_students_lessons_delete_policies.sql`
  - `supabase/README.md`
  - `PROJECT_LOG.md`
  - `docs/logs/PROJECT_LOG_ARCHIVE.md`
- **Commands run:**
  - `npx tsc --noEmit`
- **How to verify:**
  - New student/new lesson: confirm admin users are not shown in assignable instructor options.
  - Edit student: tap `Save student` and confirm a save confirmation appears before update.
  - New/edit lesson: tap save/create and confirm confirmation appears before mutation.
  - Student profile: confirm red `Delete student` appears below archive/unarchive and deletes after confirmation.
  - Edit lesson: confirm top-right icon-only delete button appears and deletes after confirmation.
  - Apply `supabase/migrations/011_students_lessons_delete_policies.sql` before testing deletes against Supabase.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Refactor AGENTS.md using full project log history
- **Summary:**
  - Reviewed all entries in `PROJECT_LOG.md` and `docs/logs/PROJECT_LOG_ARCHIVE.md` to align instructions with current implemented behavior.
  - Replaced the oversized spec-style `AGENTS.md` with a concise operations guide focused on current app reality and durable working rules.
  - Preserved mandatory workflow items (MCP lookup expectations, migrations process, log/commit/verification requirements) while removing outdated or redundant sections.
- **Files changed:**
  - `AGENTS.md`
  - `PROJECT_LOG.md`
  - `docs/logs/INDEX.md`
  - `docs/logs/PROJECT_LOG_ARCHIVE.md`
- **Commands run:**
  - `Get-Content -Raw AGENTS.md`
  - `Get-Content -Raw PROJECT_LOG.md`
  - `Get-Content -Raw docs/logs/PROJECT_LOG_ARCHIVE.md`
  - `rg --no-heading "^- \\*\\*Date:\\*\\*|^- \\*\\*Task:\\*\\*" PROJECT_LOG.md docs/logs/PROJECT_LOG_ARCHIVE.md`
- **How to verify:**
  - Open `AGENTS.md` and confirm it is significantly shorter and references current roles (`owner`, `admin`, `instructor`) and current feature baseline.
  - Confirm `PROJECT_LOG.md` still contains 20 entries and includes this new entry at the bottom.
  - Confirm the oldest previously active entry now exists in `docs/logs/PROJECT_LOG_ARCHIVE.md`.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Add Google Maps screen with persistent pins
- **Summary:**
  - Added a new drawer route Google Maps with a near full-screen interactive map view.
  - Implemented map layer switching (Default, Satellite, Hybrid) and pin creation via long-press or map-center placement.
  - Added pin labels/notes and optional student linking, backed by a new tenant-safe map_pins table with RLS.
  - Added map pin API/query hooks and marker selection/delete support on the map screen.
  - Added optional build-time GOOGLE_MAPS_API_KEY wiring through Expo config for react-native-maps plugin setup.
- **Files changed:**
  - .env.example
  - README.md
  - app.config.ts
  - package.json
  - package-lock.json
  - src/features/map-pins/api.ts
  - src/features/map-pins/queries.ts
  - src/navigation/MainDrawerNavigator.tsx
  - src/navigation/MapsStackNavigator.tsx
  - src/navigation/components/AppDrawerContent.tsx
  - src/navigation/screens/GoogleMapsScreen.tsx
  - src/supabase/types.ts
  - supabase/migrations/012_map_pins.sql
  - supabase/README.md
  - PROJECT_LOG.md
  - docs/logs/PROJECT_LOG_ARCHIVE.md
- **Commands run:**
  - npx expo install react-native-maps
  - npx tsc --noEmit
  - npx expo config --type public
- **How to verify:**
  - Apply supabase/migrations/012_map_pins.sql in Supabase SQL Editor.
  - Set GOOGLE_MAPS_API_KEY for local/EAS builds and rebuild the app.
  - Open drawer -> Google Maps and confirm the map renders full-screen with layer toggle controls.
  - Long-press map to add a pin, enter label/notes, optionally link a student, and save.
  - Tap an existing marker to view details, then delete it and confirm it disappears.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Fix react-native-maps config plugin startup error
- **Summary:**
  - Removed dynamic app config plugin injection for react-native-maps, which caused Expo startup to fail.
  - Kept Google Maps key wiring in app config using native fields instead (ios config googleMapsApiKey and android config googleMaps apiKey).
  - Verified Expo config resolves without PluginError and TypeScript compile still passes.
- **Files changed:**
  - app.config.ts
  - PROJECT_LOG.md
  - docs/logs/PROJECT_LOG_ARCHIVE.md
- **Commands run:**
  - npx expo config --type public
  - npx tsc --noEmit
- **How to verify:**
  - Run npm start and confirm startup no longer throws PluginError for react-native-maps.
  - Open the Google Maps screen from the drawer and confirm map renders.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Add anchored vectors, snapshots, and student address auto-pin in Google Maps
- **Summary:**
  - Added persistent map annotations with two modes: anchored vector drawings (lat/lng polylines) and snapshot annotations (map capture + doodle overlay).
  - Added annotation data layer and query hooks plus a new Supabase migration/table for multi-tenant annotation storage with role-safe RLS policies.
  - Added snapshot annotation editor modal and snapshot preview modal with stroke rendering.
  - Added Auto-pin action that geocodes all active students with addresses and creates map pins for students not already pinned.
  - Updated the Google Maps screen to render saved vector overlays, create/delete annotations, and expose the new annotation workflows.
- **Files changed:**
  - README.md
  - supabase/README.md
  - supabase/migrations/013_map_annotations.sql
  - src/supabase/types.ts
  - src/features/map-annotations/api.ts
  - src/features/map-annotations/queries.ts
  - src/features/map-annotations/codec.ts
  - src/navigation/components/SnapshotAnnotationModal.tsx
  - src/navigation/components/SnapshotPreviewModal.tsx
  - src/navigation/screens/GoogleMapsScreen.tsx
  - PROJECT_LOG.md
  - docs/logs/PROJECT_LOG_ARCHIVE.md
- **Commands run:**
  - npx tsc --noEmit
- **How to verify:**
  - Apply supabase/migrations/013_map_annotations.sql in Supabase SQL Editor.
  - Open drawer -> Google Maps, select a pin, tap Anchored vector, draw on map, and save; confirm saved lines re-render when reopening the pin.
  - Select a pin, tap Snapshot, draw over the captured image, save, then tap the snapshot item to confirm preview rendering.
  - Tap Auto-pin active student addresses and confirm pins are created for active students with addresses that were not already pinned.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Google Maps main-map annotations + NZ address autocomplete
- **Summary:**
  - Added main-map annotation support so anchored vectors and snapshots work even when no pin is selected.
  - Added drawing controls for anchored vectors and snapshots: color, line thickness, text placement, undo, and redo.
  - Added NZ-only Google address search/autocomplete on Google Maps and zoom-to-address behavior.
  - Added reusable NZ address autocomplete input and integrated it into student address editing.
  - Extended annotation payload parsing/serialization to persist styled strokes and text labels.
- **Files changed:**
  - `.env.example`
  - `README.md`
  - `app.config.ts`
  - `src/components/AddressAutocompleteInput.tsx`
  - `src/features/maps/places.ts`
  - `src/features/map-annotations/codec.ts`
  - `src/navigation/components/SnapshotAnnotationModal.tsx`
  - `src/navigation/components/SnapshotPreviewModal.tsx`
  - `src/navigation/screens/GoogleMapsScreen.tsx`
  - `src/navigation/screens/StudentEditScreen.tsx`
  - `PROJECT_LOG.md`
  - `docs/logs/PROJECT_LOG_ARCHIVE.md`
- **Commands run:**
  - `npx tsc --noEmit`
  - `npx expo config --type public`
- **How to verify:**
  - Open `Google Maps`, type an NZ address, pick autocomplete suggestion, and confirm the map zooms to that location.
  - In `Google Maps`, use top-panel `Anchored vector` and `Snapshot` (without selecting a pin) and confirm color/width/text + undo/redo + save all work.
  - Select an existing pin and confirm the same annotation tools still work for pin-scoped annotations.
  - Open `Students` -> `New/Edit student` and confirm the Address field now shows NZ autocomplete suggestions while typing.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Google Maps cleanup: remove vectors + snapshot UI updates
- **Summary:**
  - Removed Anchored vector workflows from the Google Maps UI and map annotation codec, keeping snapshot annotations and pin workflows intact.
  - Updated map controls layout: removed top-right refresh, changed add button icon to Lucide `Pin`, moved layer tabs above address search, and replaced the separate search button with inline Clear beside the address input.
  - Moved snapshot capture controls into bottom annotation cards (main map + selected pin) as square icon buttons.
  - Updated Snapshot Annotation modal: added line-thickness icons beside size labels, added black as a draw color option, switched Undo/Redo to icon-only buttons, and right-aligned Save snapshot.
  - Hardened Auto-pin geocoding by trying Google geocode first (when configured), then Expo geocode fallback, and surfacing the first failure reason when insert errors occur.
- **Files changed:**
  - `src/navigation/screens/GoogleMapsScreen.tsx`
  - `src/navigation/components/SnapshotAnnotationModal.tsx`
  - `src/components/AddressAutocompleteInput.tsx`
  - `src/features/map-annotations/codec.ts`
  - `PROJECT_LOG.md`
  - `docs/logs/PROJECT_LOG_ARCHIVE.md`
- **Commands run:**
  - `npx tsc --noEmit`
  - `rg -n "anchored_vector|vector" src/navigation/screens/GoogleMapsScreen.tsx src/features/map-annotations/codec.ts`
- **How to verify:**
  - Open `Google Maps` and confirm top-right shows only one square add-pin icon button (no refresh button).
  - Confirm map layer tabs are above the address input, and the Clear button is beside the input on the right.
  - Confirm there is no Anchored vector button/workflow and no vector counts/listing in bottom cards.
  - In `Main Map Annotations`, confirm Snapshot is a right-aligned square camera icon button; tap it and save a snapshot.
  - Open Snapshot Annotation modal and confirm: black color is available, size options show an icon + px label, Undo/Redo are icon-only, and Save snapshot is right-aligned.
  - Tap `Auto-pin active student addresses` and confirm it no longer reports generic unexpected failures for geocoder path issues.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Center Google Maps add-pin icon button
- **Summary:**
  - Fixed shared `AppButton` icon-only layout so internal content gap is only applied when both icon and label exist.
  - This centers icon-only buttons, including the top-right Google Maps add-pin button.
- **Files changed:**
  - `src/components/AppButton.tsx`
  - `PROJECT_LOG.md`
  - `docs/logs/PROJECT_LOG_ARCHIVE.md`
- **Commands run:**
  - `Get-Content -Raw AGENTS.md`
  - `Get-Content -Raw PROJECT_LOG.md`
  - `Get-Content -Raw docs/logs/INDEX.md`
  - `rg -n "add pin|Add pin|Pin|pin" src/navigation/screens/GoogleMapsScreen.tsx`
  - `Get-Content -Raw src/navigation/screens/GoogleMapsScreen.tsx`
  - `Get-Content -Raw src/components/AppButton.tsx`
  - `Get-Content -Raw src/theme/theme.ts`
  - `npx tsc --noEmit`
- **How to verify:**
  - Open `Google Maps` screen.
  - Confirm the top-right blue add-pin button icon is visually centered.
  - Confirm other icon-only square buttons (e.g. snapshot camera) remain centered.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Harden icon-only button centering for map controls
- **Summary:**
  - Added a dedicated `icon` button size in shared theme/button primitives to avoid conflicting NativeWind utility classes for icon-only controls.
  - Updated icon-only buttons on Google Maps, Snapshot Annotation modal, and Lessons month navigation to use `size="icon"` instead of class-based height/width overrides.
  - This removes inherited `md` spacing conflicts and centers icons consistently inside square buttons.
- **Files changed:**
  - `src/theme/theme.ts`
  - `src/components/AppButton.tsx`
  - `src/navigation/screens/GoogleMapsScreen.tsx`
  - `src/navigation/components/SnapshotAnnotationModal.tsx`
  - `src/navigation/screens/LessonsListScreen.tsx`
  - `PROJECT_LOG.md`
  - `docs/logs/PROJECT_LOG_ARCHIVE.md`
- **Commands run:**
  - `Get-Content -Raw src/navigation/screens/GoogleMapsScreen.tsx`
  - `Get-Content -Raw src/navigation/components/SnapshotAnnotationModal.tsx`
  - `Get-Content -Raw src/features/weather/WeatherWidget.tsx`
  - `Get-Content -Raw src/components/AppButton.tsx`
  - `Get-Content -Raw src/theme/theme.ts`
  - `npx tsc --noEmit`
- **How to verify:**
  - Open `Google Maps` and confirm the top-right add-pin icon is centered inside its blue square button.
  - In `Main Map Annotations`, confirm the camera icon is centered inside its square button.
  - Open Snapshot Annotation and confirm Undo/Redo icons are centered in their square buttons.
  - Open Lessons list and confirm month nav chevron icons are centered in square controls.

---

- **Date:** 2026-02-07 (Pacific/Auckland)
- **Task:** Snapshot text sizes + automatic student auto-pin
- **Summary:**
  - Added selectable text-size controls in Snapshot Annotation and persisted text size in annotation payloads.
  - Updated snapshot editor and preview rendering to respect per-text font size, with backward-compatible default sizing for existing saved snapshots.
  - Removed the manual `Auto-pin active student addresses` button and switched Google Maps to automatic background auto-pin for active students with addresses.
- **Files changed:**
  - `src/features/map-annotations/codec.ts`
  - `src/navigation/components/SnapshotAnnotationModal.tsx`
  - `src/navigation/components/SnapshotPreviewModal.tsx`
  - `src/navigation/screens/GoogleMapsScreen.tsx`
  - `PROJECT_LOG.md`
  - `docs/logs/PROJECT_LOG_ARCHIVE.md`
- **Commands run:**
  - `Get-Content -Raw AGENTS.md`
  - `Get-Content -Raw PROJECT_LOG.md`
  - `Get-Content -Raw docs/logs/INDEX.md`
  - `mcp__context7__resolve-library-id (react-native-svg)`
  - `mcp__context7__query-docs (/software-mansion/react-native-svg)`
  - `npx tsc --noEmit`
- **How to verify:**
  - Open `Google Maps` and confirm there is no `Auto-pin active student addresses` button.
  - Ensure there are active students with valid addresses and verify their pins appear automatically after map data loads.
  - Open Snapshot Annotation, enter text, choose different text sizes, place labels, save, and reopen preview.
  - Confirm placed labels render at the chosen font sizes both in editor and preview.
